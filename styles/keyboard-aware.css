/* Keyboard-aware layouts for mobile */

/* When keyboard is open */
body.keyboard-open {
  /* Prevent scrolling issues */
  overflow: hidden;
  position: fixed;
  width: 100%;
}

/* Adjust main content when keyboard is open */
@media (max-width: 768px) {
  body.keyboard-open main,
  body.keyboard-open .main-content {
    /* Use available height */
    height: 100vh;
    height: calc(var(--vh, 1vh) * 100);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Hide non-essential elements when keyboard is open */
  body.keyboard-open .hide-on-keyboard {
    display: none !important;
  }
  
  /* Reduce padding/margins */
  body.keyboard-open .container {
    padding-top: 0.5rem !important;
    padding-bottom: 0.5rem !important;
  }
  
  /* Sticky headers stay visible */
  body.keyboard-open .sticky-header {
    position: sticky !important;
    top: 0 !important;
    z-index: 40 !important;
    background: white !important;
  }
  
  /* Form adjustments */
  body.keyboard-open form {
    padding-bottom: 1rem !important;
  }
  
  /* Keep active input in view */
  body.keyboard-open input:focus,
  body.keyboard-open textarea:focus,
  body.keyboard-open select:focus {
    position: relative;
    z-index: 10;
  }
  
  /* Ensure submit button is visible */
  body.keyboard-open .form-submit,
  body.keyboard-open button[type="submit"] {
    position: sticky !important;
    bottom: 0 !important;
    background: white !important;
    z-index: 30 !important;
    width: 100% !important;
    padding: 1rem !important;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1) !important;
  }
}

/* Visual Viewport adjustments */
@supports (height: 100vh) {
  .keyboard-aware-container {
    min-height: 100vh;
    /* Use CSS custom property for dynamic viewport height */
    min-height: calc(var(--vh, 1vh) * 100);
    transition: min-height 0.3s ease-out;
  }
}

/* Form container optimizations */
.keyboard-aware-form {
  display: flex;
  flex-direction: column;
  min-height: 100%;
}

.keyboard-aware-form-content {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 5rem; /* Space for submit button */
}

.keyboard-aware-form-actions {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border-top: 1px solid #e5e7eb;
  padding: 1rem;
  z-index: 30;
}

/* iOS specific fixes */
@supports (-webkit-touch-callout: none) {
  /* iOS Safari keyboard handling */
  body.keyboard-open {
    position: fixed !important;
    width: 100% !important;
  }
  
  /* Prevent rubber band scrolling */
  .keyboard-aware-container {
    overscroll-behavior: none;
  }
}

/* Input focus states with keyboard awareness */
@media (max-width: 768px) {
  input:focus,
  textarea:focus,
  select:focus {
    /* Ensure proper outline on focus */
    outline: 2px solid #3b82f6 !important;
    outline-offset: 2px !important;
    
    /* Scroll margin for better visibility */
    scroll-margin: 100px;
  }
  
  /* Textarea specific adjustments */
  body.keyboard-open textarea {
    min-height: 80px !important;
    max-height: 120px !important;
    resize: none !important;
  }
}

/* Step forms with keyboard awareness */
.step-form-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.step-form-header {
  flex-shrink: 0;
  position: sticky;
  top: 0;
  background: white;
  z-index: 20;
  padding: 1rem;
  border-bottom: 1px solid #e5e7eb;
}

.step-form-content {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 1rem;
  padding-bottom: 6rem; /* Space for navigation */
}

.step-form-navigation {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border-top: 1px solid #e5e7eb;
  padding: 1rem;
  display: flex;
  gap: 0.5rem;
  z-index: 30;
}

/* Landscape mode with keyboard */
@media (max-width: 768px) and (orientation: landscape) {
  body.keyboard-open .step-form-header {
    padding: 0.5rem 1rem !important;
  }
  
  body.keyboard-open .step-form-content {
    padding: 0.5rem 1rem !important;
    padding-bottom: 5rem !important;
  }
  
  body.keyboard-open h1,
  body.keyboard-open h2 {
    font-size: 1.25rem !important;
  }
  
  body.keyboard-open .hide-on-landscape-keyboard {
    display: none !important;
  }
}

/* Safe area adjustments for notched devices */
@supports (padding: max(0px)) {
  .keyboard-aware-form-actions,
  .step-form-navigation {
    padding-bottom: max(1rem, env(safe-area-inset-bottom)) !important;
  }
}

/* Animation for keyboard appearance */
@media (max-width: 768px) {
  .keyboard-aware-form-actions,
  .step-form-navigation {
    transition: transform 0.3s ease-out;
  }
  
  body:not(.keyboard-open) .keyboard-aware-form-actions,
  body:not(.keyboard-open) .step-form-navigation {
    transform: translateY(0);
  }
  
  body.keyboard-open .keyboard-aware-form-actions,
  body.keyboard-open .step-form-navigation {
    transform: translateY(0);
  }
}